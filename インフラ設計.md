# ITインフラとは

インフラ…Infrastructureの略語で「基盤」のこと

- 鉄道、船舶、バス→移動手段としてのインフラ
- 電話、インターネット→コミュニケーションをとるためのインフラ
- 水道、電気、ガス→生活をするためのインフラ

つまりインフラとは…

ある何かの機能・サービスを提供する上で下支えとなる土台や仕組みのこと

ではITインフラとは…

- ハードウェア
- ネットワーク
- OS
- ミドルウェア

# ITインフラの使命

利用者が不都合なくサービスを利用するためには…

- 安定したサービス
- 障害に備えた仕組み作り
- 十分な性能
- 将来への拡張性
- 安全な環境作り

### 安定したサービス

- 交通網が混乱→渋滞・遅延が発生
- ライフラインが止まる→生活が困難

- ITインフラが不安定→サービスに支障をきたす
  システムがサービスを提供する間、正常な稼働を継続できることが求められる

### 障害に備えた仕組み作り

- 電車で事故→生活の足は混乱する
- 整備が不十分な道路→事故につながる

ITインフラも様々なトラブルが発生する
可能性をゼロにすることはできないので…

- 障害時でも代替の設備または機能により、サービスを継続できること
- 障害からの復旧を短時間で行うこと

### 十分な性能

- 主要な道路→交通量にあわせて車線の数などを調整する機能が求められる
- 電気事業者→使用者に必要な量を供給できる電気網を整備している

ITインフラであれば…

- 利用者に快適でストレスを感じさせない性能を持っている必要あり
- 需要量・負荷を試算して十分なキャパシティを確保する必要あり

### 将来への拡張性

- 交通量が増加→道路の拡張や新設が計画されて実施される
- 電気→利用者や使用料の変化に対応すべく、発電者や送電線設備を見直す

システムを運用し続けると…

- 高度化する機能の負荷増大、利用者の増加などに応じて、インフラの性能向上が必要となる
- 機能の追加や拡張があれば、より高機能・高容量なインフラが要求される

将来の需要量に対応できる拡張性を持たせることを考慮する必要あり

### 安全な環境作り

- 道路→信号、標識を立てて、事故防止の対策をする
- ライフライン→漏電やガス漏れを防止するための設備を備えている

個人や企業の重要な情報がインターネット上を飛び交う現代…

- 認証機能等で利用者を特定し、権限の範囲内での使用を可能とする
- 個人情報や取引内容等の重要データの機密性を確保し、第三者への漏洩を防ぐ
- ハッカーやウィルス等の脅威から防御する

認証・暗号化といった仕組み～監視・運用まで、セキュリティ対策に対して多角的な検討が必要

# インフラ構築の流れ

ウォーターフォールモデルにおけるプロジェクトの各工程

1. 企画
2. 計画
3. 要件定義
4. 設計
5. 製造(構築)
6. テスト
7. 運用保守

### 企画

掲げる目的を達成させるために...
プロジェクトを発足させるための企画書を作成→経営層に承認

企画工程の詳細の流れ

1. 企画書の作成
2. 開発ベンダーの選定
   1. RFP(Request For Proposal)という提案依頼書を開発ベンダーに提示
   2. RFPの情報をもとに開発ベンダーは提案書を作成
   3. 複数の開発ベンダーから提示された提案書の中から選定
   4. 選定した開発ベンダーと受発注契約を結ぶ

### 計画

開発ベンダーを選定したら続いて計画工程
計画工程...今後のプロジェクトの進め方や役割分担を明確にする工程

主なチーム構成

* プロジェクト管理チーム
* インフラ構築チーム
* アプリケーション開発チーム
* ネットワーク構築チーム
* データ移行チーム
* 開発環境運用チーム

各チームは

* 決められた計画スケジュールの中で
* 決められたインプット情報をもとに
* 決められた成果物をアウトプットする

### 要件定義

要件定義...どんなシステムを作り、どんなことを実現したいのか、を文書で定義する作業

- 様々なユーザー要求を洗い出して導入システムの業務や仕様を明確化していく
- どの機能(業務)をシステムとして実装するかを「業務要件」と「システム要件」に分ける

要件定義の範囲には2種類ある

- 機能要求→業務要件のこと
- 非機能要求→システム要件のこと ※インフラはこっち

要件定義の内容は要件定義書と呼ばれるドキュメント上で合意形成をとるやり方が一般的
システム仕様をよく知っている開発ベンダーが作成(または作成支援)することが多い

要件定義の流れ

1. 要求抽出
2. 要件分析
3. 要件仕様化
4. 妥当性確認
5. ユーザーレビュー

### 設計

要件定義でユーザーが実現したい要件がすべてまとまった状態
設計工程はユーザーの要件定義の内容をすべて満たすためのシステム設計を行っていく

インフラエンジニアが行う設計

- アーキテクチャ設計
- システム構成設計
- 運用設計
- (ネットワーク設計も入るかな？)

インフラ設計の流れ
1. 要件定義をインプットとして基本設計書を作成
2. 基本設計書をインプットとして詳細設計を作成

### 製造(構築)

システム環境を構築する工程
OSのインストールやミドルウェアの設定など

### テスト

段階的に行う

1. 単体テスト
2. 結合テスト
3. システムテスト
4. 運用テスト
5. 受け入れテスト

### 運用保守

システム運用の代表例

- 監視運用
- バックアップ運用
- ウィルス対策運用
- バッチ、ファームウェア適用
- 自動化運用

### プロジェクトライフサイクル

運用保守がプロジェクトの最後の工程にはならないことに注意
システム開発のライフサイクルはまた企画工程に戻るため終わりがない

重要な心がけ
- 次のステージへの継続や移行が容易に行えるよう設計や作りこみの時点で配慮すべし
- 次の担当者が正しく引き継げるよう仕様書やマニュアルなどの手がかりをきちんと残すべし

# ITシステムにおける「機能要求」と「非機能要求」

要件定義を詳しく見ていきましょう

前述したとおり、ITシステムに対する要求事項には次の2つがあります。

- **機能要求**：システムが「何ができるか」に関する要求
  - 例：受注登録ができる、在庫確認ができる、請求書を発行できる など
- **非機能要求**：システムが「どのように動くか」に関する要求
  - 例：止まりにくさ（可用性）、速さ（性能）、将来の拡張のしやすさ（拡張性）、運用・保守のしやすさ、セキュリティ など

非機能要求は業務機能とは異なり、**あいまいな要求をどう整理するかが重要なポイント** です。
また、非機能要求の大部分は **ITインフラの設計・実装** によって実現できます。

#### たとえ話：家の「間取り」と「住み心地」

- 機能要求：
  - 「3LDKがいい」「リビングは20畳くらいほしい」「対面キッチンにしたい」
- 非機能要求：
  - 「地震に強い家がいい」「冬でも暖かい家がいい」「ネットが快適に使える家がいい」

間取りは目に見える「何ができるか」（機能要求）ですが、住み心地や耐久性は普段あまり意識されないものの、とても大事な「どう動くか」（非機能要求）です。

ITインフラは、この「住み心地」を支える基礎・配線・配管のような存在だと考えるとイメージしやすいでしょう。


## なぜ非機能要求は難しいのか

「非機能要求がなぜ難しいか」を具体的に説明していきます。

### 非機能要求は専門的で、ユーザーが関心を持ちにくい

- 非機能要求は **業務要求（機能要求）とは異なり、ITへの専門性が高い**。
- プロジェクトの初期段階では、ユーザー（業務側）は
  - 「どんな機能がほしいか」には関心があるが、
  - 「どのくらい落ちてはいけないか」「どれくらい速くしたいか」といった項目にはピンと来にくい。

そのため、

- ユーザーはベンダーに対して **具体的な非機能要求を提示しづらい**
- 結果として、非機能要求があいまいなまま次の工程へ進んでしまう

という問題が発生しやすくなります。

### ユーザーとベンダーのギャップ

ユーザーとベンダー双方の立場を見ていきましょう。

- **ユーザー側の問題**
  - 非機能要求は専門性が高く、かつ業務そのものではないため関心を持ちにくい
  - その結果、「具体的な要求提示が困難」となりがち

- **ベンダ側の問題**
  - 「なぜこの方式・製品が必要なのか」「なぜこのレベルの可用性が必要なのか」を、
    ユーザーに分かるように説明するのが難しい
  - そのため「ベンダ主導での提案が難しい」

こうしたギャップにより、次のようなリスクが生じます。

- システム開発プロジェクト運営への影響
  - 基盤の変更、下流工程での問題発生 など
- システム運用上のリスク拡大
  - 想定外の使われ方、極限状態での利用 など

#### たとえ話：注文内容が曖昧な「オーダーミス」

レストランでの会話を想像してください。

- お客さん「辛さは、まあ普通でいいです」
- 店側「（普通ってどのくらいだろう…）とりあえず中辛で出そう」

→ 食べてみて、お客さんが「辛すぎる！」とクレーム。

このとき、

- お客さんは「自分の感覚では普通」
- 店側は「自分の基準で普通」

という **暗黙の前提のズレ** が原因です。

非機能要求でも同じようなことが起こりやすく、「普通に速く」「できるだけ止めないで」といった言葉では、具体的な設計指針になりません。

### 数値で示されないことによる認識のズレ

非機能要求が **具体的な数値として提示されない** ことによる問題を、耐障害性の例を使って説明します。

- ユーザー：「可能な限り早く復旧してほしいな！」
- ベンダー：「じゃあ1時間以内に復旧できれば十分だな」

しかし障害発生時、ユーザーはこう感じます。

- ユーザー：「なんで復旧に1時間もかかるの？遅すぎる！」

ベンダー側はこう思います。

- ベンダー：「最初から具体的に言ってもらえないと分かりませんよ！」

このような事態は、後工程に入ってから発覚すればするほど、修正に必要な手戻り工数が膨らみます。

#### 補足：インフラ設計でよく使う「数値指標」

一般的なインフラ設計では、非機能要求を次のような指標で表現します。

- 可用性：稼働率（例：99.99%）、RTO（復旧時間目標）、RPO（目標復旧時点）
- 性能：レスポンスタイム（例：1秒以内）、スループット（1秒あたりの処理件数）
- 拡張性：最大接続ユーザ数の想定、増設可能なサーバ台数
- セキュリティ：アカウントロックまでの失敗回数、ログ保管期間 など

数値で示すことで、ユーザーとベンダの認識を揃えやすくなります。


## 非機能要求グレードの活用

### 非機能要求グレードとは

前述したユーザーとベンダーの行き違いや異なる理解を防止するために、

> 「非機能要求グレード」の活用を推奨している

- 非機能要求グレードは、
  - 見えにくかったシステム要求を **具体的に「見える化」** するためのツール
  - ユーザーとベンダの間の **共通ツール**

IPA（情報処理推進機構）のサイトから誰でもダウンロードできます。

### 障害回復（サービス切替時間）のグレード例

非機能要求グレードの例として、障害回復（サービス切替）の時間について、次のようなレベル分けが示されています。

- メトリクス（指標）：サービス切替時間
- レベルと対応する時間の目安：
  - レベル0：24時間以上
  - レベル1：24時間未満
  - レベル2：2時間未満
  - レベル3：60分未満
  - レベル4：10分未満
  - レベル5：60秒未満

これにより、「障害回復までにかかる時間」が明確な数字で定義されます。

#### たとえ話：辛さレベル表

カレー屋さんなどでよくある「辛さレベル表」をイメージすると分かりやすいです。

- 0：甘口
- 1：中辛
- 2：辛口
- 3：大辛
- 4：激辛

「辛さはお任せ」ではなく、「レベル2で」と指定することで、注文者とお店の認識を合わせられます。

非機能要求グレードも同じで、「できるだけ早く復旧」ではなく、

- 「サービス切替時間はレベル3（60分未満）」
- 「重要なシステムだからレベル5（60秒未満）」

といった形で、**期待値を具体的に合わせる** ことができます。


# インフラ設計のセオリー

### 設計工程における4つの柱

要件が明確になった後の **設計工程** について見ていきましょう。

特に、インフラ設計の「肝」となる4つの観点で見ていきます。

1. 可用性
2. 性能・拡張性
3. 運用・保守性
4. セキュリティ

これら4つの観点のうち、今回は可用性を詳しく見ていきます。（他は別枠でやります。）

### 例：可用性設計の1つ「システムの冗長化」

可用性設計の一例として **システムの冗長化** が取り上げてみます。

- サーバの冗長化方式には大きく分けて2通り：
  1. 並列クラスタ方式
  2. HAクラスタ方式

実際にインフラを構成する際に、どちらを選ぶべきか？という観点で見ていきましょう。

#### 一般的な補足：冗長化の基本的な考え方

冗長化とは、**「1つ壊れても全体が止まらないようにする」** ために、同じ役割を持つ機能を複数準備しておくことです。

- 電車でいう「複々線」：片側が使えなくてももう一方で運行できる
- データセンターでいう「二重化電源」：片系の電源が落ちても、もう片方で給電できる

サーバやネットワークでも、同じ発想で冗長構成を考えます。

# 冗長化パターン

## 並列クラスタ方式

### 概要

並列クラスタ方式とは、

> 並列クラスタ方式は、同じ機能と役割を持つ複数台のサーバを並列稼働させて、そのうちのどれかが障害になっても残りのサーバでシステムを継続できる構成です。

- Webサーバ#1, #2, #3
- 負荷分散装置がアクセスを振り分ける
- 1台落ちても他のサーバが処理を続ける

### 特徴

並列クラスタ方式の主な特徴：

- 停止時間：
  - 同一機能のサーバが複数稼働しているため、ほとんど停止時間がない（評価：○）
- 性能：
  - 負荷分散されるため、個別サーバの負荷が軽減される（評価：○）
- 一意性・順序保証：
  - 並列処理が前提なので、トランザクションの一意性や処理順序は保証されない（評価：△）
- データ共有：
  - 各サーバが個別に情報を保持する構成だと、データを共有できない（評価：△）

#### たとえ話：レジが複数あるスーパー

スーパーのレジをイメージしてみてください。

- レジが1台だけ ⇒ 故障したら会計ができなくなる
- レジが3台 ⇒ 1台故障しても、他の2台で会計継続

これはまさに「並列クラスタ」です。

- お客さん（ユーザー）の列が分散される ⇒ 性能が良い
- 特定のレジが止まっても、他で対応できる ⇒ 高い可用性

一方で、各レジが独自のメモを持っているようなイメージだと、完全に同じ情報を共有するのは難しくなります。（なので、並列クラスタ＋共有DBなどの組み合わせで設計されることが多いです）


## HAクラスタ方式

### 概要

HAクラスタとは、

> HAクラスタは、同じ機能・役割を持つ2台のサーバを稼働系と待機系という形で稼働させ、通常は稼働系のみで処理を行い、稼働系に障害が発生した場合に待機系が稼働系へと昇格することでシステム処理を継続する構成です。

- 稼働系 DBサーバ（正）
- 待機系 DBサーバ（副）
- DBMS 製品
- HAクラスタ製品
- 共有ディスク（ディスクアレイ）
- アプリケーションからは「サービスIPアドレス」に接続

通常時：

- 稼働系DBサーバのみが動作
- 待機系はスタンバイ状態で、共有ディスクへのI/Oは発生しない
- DBの制御情報やデータは共有ディスクに置かれており、クラスタメンバ間で共有される

### 特徴

HAクラスタ方式の主な特徴：

- 停止時間：
  - 障害時に待機系を稼働系に昇格するため、一定時間のサービス停止が発生（評価：△）
- 性能：
  - 通常時は1台のサーバで処理するため、負荷が集中しやすい（評価：△）
- 一意性・順序保証：
  - 単独サーバで処理する前提なので、順序や一意性を保証しやすい（評価：○）
- データ共有：
  - 共有ディスクを持つことで、データの一意性・共有性を確保しやすい（評価：○）

#### たとえ話：運転士と控えの運転士

電車の運転士を想像してください。

- 1人の運転士（稼働系）が電車を運転
- もう1人の運転士（待機系）は控えで待機
- 運転士が体調不良になれば、控えの運転士が交代して運転を続行

交代の瞬間には一時的な停止（スムーズにいっても少しの時間）が発生しますが、

- 電車そのもの（車両）は1編成で一意
- 運行の順序やルートは一貫している

という意味で「一意性」や「順序」が保たれます。

DBのHAクラスタも同じで、

- システムとしての一意性が重要（同じデータが2重に書かれては困る）
- 処理の順序が重要なケース（トランザクション処理）が多い

という理由から、こうした構成が使われます。


## 並列クラスタとHAクラスタの比較

並列クラスタ方式とHAクラスタ方式を表形式で比較してみましょう。

### 比較カテゴリ

比較されているカテゴリは次の4つです。

1. 停止時間
2. 性能
3. 一意または順序保証
4. データの共有

### 比較結果のまとめ

| カテゴリ               | 並列クラスタ | 評価 | HAクラスタ | 評価 |
|------------------------|--------------|------|-----------|------|
| 停止時間               | ほとんどない | ○    | 切替で停止 | △    |
| 性能                   | 負荷分散で有利 | ○  | 負荷集中   | △    |
| 一意または順序保証     | 保証されない | △    | 保証される | ○    |
| データの共有           | できない     | △    | できる     | ○    |

### どちらを選ぶべきか？

- **並列クラスタが向いているケース（例）**
  - Webサーバのように「同じ処理を並列にさばける」コンポーネント
  - 少し順番が前後しても業務に支障が少ない処理
  - 多数のユーザーアクセスをさばきたい場合（性能重視）

- **HAクラスタが向いているケース（例）**
  - DBサーバのように、一意性や順序が重要なコンポーネント
  - データの整合性・共有が最重要となるシステム
  - 多少の切替時間は許容できるが、データの壊れや不整合は許容できない場合

#### 一般的な補足：クラウド時代の冗長化

オンプレミスだけでなく、クラウド（例：IaaS、PaaS）でも考え方は同じです。

- 並列クラスタ相当：
  - オートスケールするWebサーバ群、コンテナのレプリカなど
- HAクラスタ相当：
  - マネージドDBのマルチAZ構成、フェイルオーバーグループなど

クラウドサービス側で冗長化が提供されている場合でも、

- 自分のシステムが「停止時間」「性能」「一意性」「共有」のどれを重視するのか

を理解しておくことで、適切なサービス・構成を選びやすくなります。


# おわりに

インフラ設計は、一見すると難しそうに見えますが、

- 「どんな条件（非機能要求）を満たしたいか」をはっきりさせる
- その条件に合った「構成パターン（セオリー）」を選ぶ

という **型** を身につけてしまえば、ぐっと理解しやすくなります。

最初は、

1. 可用性：どのくらい止まってはいけないか
2. 性能：どれくらい速く・どれくらいの量をさばきたいか
3. 運用・保守性：運用担当者がどのくらい楽になるべきか
4. セキュリティ：どのくらいの安全性が必要か

といった観点から、「非機能要求」を言語化する練習をしてみてください。

そのうえで、今回のような冗長化パターン（並列クラスタ・HAクラスタ）をはじめとした
インフラ設計のセオリーを学んでいくと、実務でも応用しやすくなります。
